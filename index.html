<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø¥ØªÙ‚Ø§Ù†</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        // ============================================
        // FIREBASE INITIALIZATION
        // ============================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
        import { getFirestore, collection, doc, getDocs, setDoc, addDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAyTfVJ2sx-OGUx_ny1_W1QRvzkjA7_aAQ",
            authDomain: "itqan-platform-4b7cc.firebaseapp.com",
            projectId: "itqan-platform-4b7cc",
            storageBucket: "itqan-platform-4b7cc.appspot.com",
            messagingSenderId: "59657931493",
            appId: "1:59657931493:web:695e8fb4053156aad1220c",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let currentUser = null;
        let isAdmin = false;
        let platformData = {
            subjects: [],
            teachers: [],
            videos: [],
            files: [],
        };

        // ============================================
        // AUTHENTICATION
        // ============================================
        function handleLogin(role) {
            if (role === 'student') {
                currentUser = { name: "Ø·Ø§Ù„Ø¨ Ø¥ØªÙ‚Ø§Ù†", role: "student", avatar: "Ø·" };
                isAdmin = false;
            } else if (role === 'admin') {
                const password = prompt("ðŸ” Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±:");
                if (password !== "Omran#05") {
                    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
                    return;
                }
                currentUser = { name: "Ø§Ù„Ù…Ø¯ÙŠØ± Ø¹Ù…Ø±Ø§Ù†", role: "admin", avatar: "Ù…" };
                isAdmin = true;
            }

            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('user-avatar').textContent = currentUser.avatar;

            loadPlatformData();
        }

        // ============================================
        // FIRESTORE DATA FUNCTIONS
        // ============================================
        async function loadPlatformData() {
            // Subjects
            const subjectsSnap = await getDocs(collection(db, "subjects"));
            platformData.subjects = subjectsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            // Teachers
            const teachersSnap = await getDocs(collection(db, "teachers"));
            platformData.teachers = teachersSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            // Videos
            const videosSnap = await getDocs(collection(db, "videos"));
            platformData.videos = videosSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            // Files
            const filesSnap = await getDocs(collection(db, "files"));
            platformData.files = filesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            // Load UI
            loadDashboardContent();
            loadSubjects();
            loadVideos();
            loadFiles();
            loadTeachers();
            if (isAdmin) loadAdminData();
        }

        async function saveToFirestore(collectionName, data, docId = null) {
            if (docId) {
                await setDoc(doc(db, collectionName, docId), data);
            } else {
                await addDoc(collection(db, collectionName), data);
            }
            await loadPlatformData(); // reload after save
        }

        async function deleteFromFirestore(collectionName, docId) {
            await deleteDoc(doc(db, collectionName, docId));
            await loadPlatformData(); // reload after delete
        }

        // ============================================
        // EXAMPLE: ADD SUBJECT
        // ============================================
        async function adminAddSubject() {
            const name = document.getElementById('admin-subject-name').value.trim();
            const desc = document.getElementById('admin-subject-desc').value.trim();
            if (!name) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©'); return; }

            await saveToFirestore('subjects', { name, description: desc, created: new Date().toISOString() });

            document.getElementById('admin-subject-name').value = '';
            document.getElementById('admin-subject-desc').value = '';
            alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ============================================
        // ADDITIONAL ADMIN FUNCTIONS
        // ============================================
        async function adminAddTeacher() {
            const name = document.getElementById('admin-teacher-name').value.trim();
            const specialty = document.getElementById('admin-teacher-specialty').value.trim();
            const email = document.getElementById('admin-teacher-email').value.trim();
            const desc = document.getElementById('admin-teacher-desc').value.trim();
            if (!name) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…'); return; }

            await saveToFirestore('teachers', { name, specialty, email, description: desc, created: new Date().toISOString() });

            document.getElementById('admin-teacher-name').value = '';
            document.getElementById('admin-teacher-specialty').value = '';
            document.getElementById('admin-teacher-email').value = '';
            document.getElementById('admin-teacher-desc').value = '';
            alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ÙŠÙ…ÙƒÙ† ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ù„Ø¨Ù‚ÙŠØ© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù: videos, files, deleteØŒ ÙˆÙƒÙ„ Ø´ÙŠØ¡ Ù…ÙˆØ¬ÙˆØ¯
        // Ø¨Ù†ÙØ³ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŒ Ù…Ø¹ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ localStorage Ø¨ Firestore

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('login-student').onclick = () => handleLogin('student');
            document.getElementById('login-admin').onclick = () => handleLogin('admin');
        });

    </script>
</head>
<body>
    <div id="auth-screen">
        <button id="login-student">Ø¯Ø®ÙˆÙ„ ÙƒØ·Ø§Ù„Ø¨</button>
        <button id="login-admin">Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±</button>
    </div>

    <div id="app" style="display:none">
        <div id="user-avatar"></div>
        <!-- Ù‡Ù†Ø§ ØªØ¨Ù‚Ù‰ ÙƒÙ„ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙƒÙ…Ø§ Ù‡ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹ØŒ Ù†ÙØ³ HTML Ø§Ù„Ù‚Ø¯ÙŠÙ… -->
    </div>
</body>
</html>
